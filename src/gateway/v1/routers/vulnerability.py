from functools import lru_cache
import logging

from fastapi import APIRouter, Depends, status

from src.gateway.v1.models.filters import ScoreFilter, VulnerabilityFilter
from src.gateway.v1.models.responses import Vulnerability
from src.services.simulation.vulnerability_service import VulnerabilityService

logger = logging.getLogger()


@lru_cache
def vulnerability_service():
    return VulnerabilityService()

router = APIRouter(
    prefix="/vulnerability",
    tags=["vulnerability"],
)


@router.post("/")
async def read_vulnerabilities(
    skip: int = 0,
    limit: int = 100,
    vulnerability_filter: VulnerabilityFilter = Depends(),
    service: VulnerabilityService = Depends(vulnerability_service),
) -> list[Vulnerability]:
    return service.query(vulnerability_filter=vulnerability_filter, limit=limit, skip=skip)
